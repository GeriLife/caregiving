{% load crispy_forms_tags %}
{% load i18n %}

<div class="navbar bg-base-200">
  <div class="container mx-auto flex flex-row justify-between items-center">
    <!-- Left side: Logo and hamburger menu -->
    <div class="flex items-center">
      <!-- Mobile menu hamburger -->
      <div class="dropdown dropdown-bottom lg:hidden">
        <div tabindex="0" role="button" class="btn btn-ghost">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h8m-8 6h16"/>
          </svg>
        </div>
        <ul tabindex="0" class="dropdown-content menu menu-sm z-[1] p-2 shadow bg-base-200 rounded-box w-52">
          {% if user.is_authenticated %}
            <li>
              <button class="btn btn-primary btn-sm" onclick="add_work_modal.showModal()">
                {% translate "Add work" %}
              </button>
            </li>
            {% if request.user.can_add_activity %}
              <li>
                <a href="{% url 'resident-activity-form-view' %}" class="btn btn-primary btn-sm mt-2">
                  {% translate "Add activity" %}
                </a>
              </li>
            {% endif %}
          {% endif %}
          <li><a href="{% url 'work-report-view' %}">{% translate "Work Report" %}</a></li>
          <li><a href="{% url 'home-list-view' %}">{% translate "Homes" %}</a></li>
          <li><a href="{% url 'resident-list-view' %}">{% translate "Residents" %}</a></li>
          {% if user.is_authenticated %}
            <li><a href="{% url 'logout' %}">{% translate "Log out" %}</a></li>
          {% else %}
            <li><a href="{% url 'login' %}">{% translate "Log in" %}</a></li>
            <li><a href="{% url 'signup' %}">{% translate "Sign up" %}</a></li>
          {% endif %}
        </ul>
      </div>

      <!-- Site name -->
      <a href="/" class="btn btn-ghost text-xl">GeriLife Caregiving</a>
    </div>

    <!-- Center: Main navigation (desktop only) -->
    <div class="hidden lg:flex flex-1 justify-center">
      <ul class="menu menu-horizontal">
        <li><a href="{% url 'work-report-view' %}">{% translate "Work Report" %}</a></li>
        <li><a href="{% url 'home-list-view' %}">{% translate "Homes" %}</a></li>
        <li><a href="{% url 'resident-list-view' %}">{% translate "Residents" %}</a></li>
      </ul>
    </div>

    <!-- Right side: Actions, language, auth -->
    <div class="flex items-center">
      <!-- Action buttons -->
      {% if user.is_authenticated %}
        <div class="hidden lg:flex">
          <button class="btn btn-primary btn-sm mr-2" onclick="add_work_modal.showModal()">
            {% translate "Add work" %}
          </button>
          {% if request.user.can_add_activity %}
            <a href="{% url 'resident-activity-form-view' %}" class="btn btn-primary btn-sm mr-2">
              {% translate "Add activity" %}
            </a>
          {% endif %}
        </div>
      {% endif %}

      <!-- Language selector -->
      <div class="mr-2">
        {% include "i18n.html" %}
      </div>

      <!-- Authentication links -->
      <div class="hidden lg:flex">
        {% if user.is_authenticated %}
          <a href="{% url 'logout' %}" class="btn btn-ghost btn-sm">{% translate "Log out" %}</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn-ghost btn-sm mr-1">{% translate "Log in" %}</a>
          <a href="{% url 'signup' %}" class="btn btn-ghost btn-sm">{% translate "Sign up" %}</a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Modal using daisyUI dialog -->
<dialog id="add_work_modal" class="modal">
  <div class="modal-box">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">âœ•</button>
    </form>
    <h3 class="font-bold text-lg">{% translate "Add work" %}</h3>

    <form action="{% url 'work-form-view' %}" method="post" class="space-y-4">
      {% csrf_token %}

      <!-- Home field -->
      <div class="form-control w-full">
        <label class="label">
          <span class="label-text">{{ work_form.home.label }}</span>
        </label>
        <select name="{{ work_form.home.name }}" class="select select-bordered w-full">
          <option disabled selected>{% translate "Select home" %}</option>
          {% for option in work_form.home.field.queryset %}
            <option value="{{ option.id }}" {% if work_form.home.value == option.id %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
        {% if work_form.home.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ work_form.home.errors }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Type field -->
      <div class="form-control w-full">
        <label class="label">
          <span class="label-text">{{ work_form.type.label }}</span>
        </label>
        <select name="{{ work_form.type.name }}" class="select select-bordered w-full">
          <option disabled selected>{% translate "Select work type" %}</option>
          {% for option in work_form.type.field.queryset %}
            <option value="{{ option.id }}" {% if work_form.type.value == option.id %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
        {% if work_form.type.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ work_form.type.errors }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Caregiver role field -->
      <div class="form-control w-full">
        <label class="label">
          <span class="label-text">{{ work_form.caregiver_role.label }}</span>
        </label>
        <select name="{{ work_form.caregiver_role.name }}" class="select select-bordered w-full">
          <option disabled selected>{% translate "Select caregiver role" %}</option>
          {% for option in work_form.caregiver_role.field.queryset %}
            <option value="{{ option.id }}" {% if work_form.caregiver_role.value == option.id %}selected{% endif %}>{{ option }}</option>
          {% endfor %}
        </select>
        {% if work_form.caregiver_role.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ work_form.caregiver_role.errors }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Date field -->
      <div class="form-control w-full">
        <label class="label">
          <span class="label-text">{{ work_form.date.label }}</span>
        </label>
        <input type="date" name="{{ work_form.date.name }}" class="input input-bordered w-full" value="{{ work_form.date.value|date:'Y-m-d' }}" />
        {% if work_form.date.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ work_form.date.errors }}</span>
          </label>
        {% endif %}
      </div>

      <!-- Duration minutes field -->
      <div class="form-control w-full">
        <label class="label">
          <span class="label-text">{{ work_form.duration_minutes.label }}</span>
        </label>
        <input type="number" min="1" name="{{ work_form.duration_minutes.name }}" class="input input-bordered w-full" value="{{ work_form.duration_minutes.value }}" />
        {% if work_form.duration_minutes.errors %}
          <label class="label">
            <span class="label-text-alt text-error">{{ work_form.duration_minutes.errors }}</span>
          </label>
        {% endif %}
      </div>

      <div class="modal-action">
        <form method="dialog">
          <button class="btn btn-outline">{% translate "Cancel" %}</button>
        </form>
        <button type="submit" class="btn btn-primary">{% translate "Add work" %}</button>
      </div>
    </form>
  </div>
</dialog>
